exportMonthly: >
  With
       Set DefaultProductRows AS
       {TM1DRILLDOWNMEMBER({[Products].[BPSP $productPlanVersion].[$product]}, ALL, RECURSIVE )}
       MEMBER [Periods].[Periods].[ProductName] as
              [Products].[BPSP $productPlanVersion].CurrentMember.Properties('BPSP $productPlanVersion Description')
       MEMBER [Periods].[Periods].[ProductCaption] as
              [Products].[BPSP $productPlanVersion].CurrentMember.Properties('BPSP $productPlanVersion Element')
       MEMBER [Periods].[Periods].[ProductLevel] as
              [Products].[BPSP $productPlanVersion].CurrentMember.Properties('BPSP $productPlanVersion Product Level - Name')
       Set FixColumns AS
       {[Periods].[Periods].[ProductName],
        [Periods].[Periods].[ProductCaption],
        [Periods].[Periods].[ProductLevel]}
    SELECT
       {Union(FixColumns,{DRILLDOWNMEMBER({[Periods].[Periods].[$year1],[Periods].[Periods].[$year2],[Periods].[Periods].[$year3],[Periods].[Periods].[$year4]},{[Periods].[Periods].[$year1],[Periods].[Periods].[$year2],[Periods].[Periods].[$year3],[Periods].[Periods].[$year4]})},All)}
       PROPERTIES [Periods].[Periods].[Caption] ON COLUMNS ,
      {DefaultProductRows}
      PROPERTIES [Products].[BPSP $productPlanVersion].[BPSP $productPlanVersion Caption] ON ROWS
    FROM [Sales Plan by Product]
    WHERE
      (
       [LineItems Sales Plan by Product].[LineItems Sales Plan by Product].[Final Sales Plan],
       [Versions].[Versions].[$companyVersion],
       [Companies].[Companies].[$company],
       [Receivers].[Receivers].[$receiver],
       [Measures Sales Plan by Product].[Measures Sales Plan by Product].[Value]
      )

exportIpPlanningMonthly: >
  With
    --Checked out Product Element drilled down

    Set DefaultProductRows AS
    {Intersect({TM1DRILLDOWNMEMBER({[Materials].[BPSP $productPlanVersion IP].[$material]}, ALL, RECURSIVE )},
    {TM1SubsetToSet([Materials].[BPSP $productPlanVersion IP],'$company')})}

    -- Compress MDX result size with creating measures from Product Attributes for the query (decrease size from 3MB to 50KB)

    MEMBER [Periods].[Periods].[IP Name] as
      [Materials].[BPSP $productPlanVersion IP].CurrentMember.Properties('BPSP $productPlanVersion IP Name')
    MEMBER [Periods].[Periods].[IP Code] as
      [Materials].[BPSP $productPlanVersion IP].CurrentMember.Properties('Element')
    MEMBER [Periods].[Periods].[Level] as
      [Materials].[BPSP $productPlanVersion IP].CurrentMember.Properties('Product Level - Name')

    -- Create the first 3 column with information

    Set FixColumns AS
    {([Periods].[Periods].[IP Name]),
     ([Periods].[Periods].[IP Code]),
     ([Periods].[Periods].[Level])}
    Set DataColumns As
    {DRILLDOWNMEMBER({[Periods].[Periods].[$year1],[Periods].[Periods].[$year2]},{[Periods].[Periods].[$year1],[Periods].[Periods].[$year2]})}
    -- query
    SELECT
    --Columns
      {Union(FixColumns,DataColumns,All)}
      PROPERTIES [Periods].[Periods].[Caption] ON COLUMNS ,
    -- Rows
      {TM1FILTERBYLEVEL({[Instrument Types].[Instrument Types].Members}, 0)}*
      {TM1FILTERBYLEVEL({[Contract Types].[Contract Types].Members}, 0)}*
      {DefaultProductRows}
      PROPERTIES [Instrument Types].[Instrument Types].[Caption],[Contract Types].[Contract Types].[Caption],[Materials].[BPSP $productPlanVersion IP].[BPSP $productPlanVersion IP Caption] ON ROWS
    FROM [Sales Plan IP]
    WHERE
    (
      [LineItems Sales Plan IP].[LineItems Sales Plan IP].[Final Quantity Plan],
      [Versions].[Versions].[$companyVersion],
      [Companies].[Companies].[$company],
      [Receivers].[Receivers].[$receiver],
      [Measures Sales Plan IP].[Measures Sales Plan IP].[Value]
    )

